{% load static %}
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Produits - Ultimate Technology</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_editer.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_boite_dialogue.css' %}">
<style>
    .form-label{
        color : var(--text);
    }
    .form-control{
        background : var(--bg);
        color: var(--text);
    }

    .hidden {
        display: none;
    }

</style>
<body>
    {% include 'header_vendeur.html' %}

        <!-- Formulaire de modification -->
        <div class="card">
            <div class="card-header" style="background:linear-gradient(135deg,var(--accent),var(--accent-2))">
                <i class="fas fa-edit me-2"></i>Modifier le Produit
            </div>
            <div class="card-body">
                <form id="productForm" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="row">
                        <!-- Colonne gauche -->
                        <div class="col-md-6">
                            <!-- Informations de base -->
                            <div class="mb-4">
                                <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-info-circle me-2"></i>Informations de base</h5>

                                <div class="mb-3 autocomplete">
                                    <label for="marqueInput" class="form-label required-field">Marque</label>
                                    <input type="text" class="form-control" id="marqueInput" name="marque" value="{{ produit.marque }}" placeholder="ex : Dell" required>
                                    <input type="hidden" class="form-control" name="id" value="{{ produit.id }}">

                                </div>

                                <div class="mb-3">
                                    <label for="model" class="form-label required-field">Modèle</label>
                                    <input type="text" class="form-control" id="model" name="model" placeholder=" ex : Inspiron 15 3000" value="{{ produit.model }}" required>
                                </div>

                                <div class="mb-3">
                                    <label for="description" class="form-label required-field">Description</label>
                                    <textarea class="form-control" id="description" name="description" rows="8" placeholder=" ex : Ordinateur portable performant avec processeur Intel Core i5, idéal pour le travail et les études." required>{{ produit.description }}</textarea>
                                </div>
                            </div>value

                            <!-- Spécifications techniques -->
                            <div class="mb-4">
                                <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-microchip me-2"></i>Spécifications techniques</h5>

                                <div class="mb-3">
                                    <label for="cpu" class="form-label required-field">Processeur</label>
                                    <input type="text" class="form-control" id="cpu" name="cpu" value="{{ produit.cpu }}" placeholder="ex : Intel Core i5-1135G7" required>
                                </div>

                                <div class="mb-3">
                                    <label for="ram" class="form-label required-field">Mémoire RAM</label>
                                    <input type="text" class="form-control" id="ram" name="ram" value="{{ produit.ram }}" placeholder="ex: 8 Go DDR4" required>
                                </div>

                                <div class="mb-3">
                                    <label for="stockage" class="form-label required-field">Stockage</label>
                                    <input type="text" class="form-control" id="stockage" name="stockage" value="{{ produit.stockage }}" placeholder="ex: 512 Go SSD" required>
                                </div>

                                <div class="mb-3">
                                    <label for="graphic" class="form-label">Carte graphique</label>
                                    <input type="text" class="form-control" id="graphic" name="graphic" value="{{ produit.graphic }}" placeholder="ex: Intel Iris Xe Graphics">
                                </div>
                            </div>
                        </div>

                        <!-- Colonne droite -->
                        <div class="col-md-6" >
                            <!-- Prix et promotions -->
                            <div class="price-container mb-4" style="background:var(--card);border:2px solid var(--text); box-shadow: 0 0 6px var(--text)">
                                <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-tag me-2"></i>Prix et promotions</h5>

                                <div class="mb-3">
                                    <label for="ancien_prix" class="form-label">Ancien prix</label>
                                    <input type="number" class="form-control" id="ancien_prix" name="ancien_prix" value="{{ produit.ancien_prix }}">
                                </div>

                                <div class="mb-3">
                                    <label for="nouveau_prix" class="form-label required-field">Nouveau prix</label>
                                    <input type="number" class="form-control" id="nouveau_prix" name="nouveau_prix" value="{{ produit.nouveau_prix }}" required>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="est_promo" name="est_promo" {% if produit.est_promo %}checked{% endif %}>
                                        <label class="form-check-label" for="est_promo">Produit en promotion</label>
                                    </div>
                                </div>

                                <div class="mb-3" id="prixPromoGroup">
                                    <label for="prix_promo" class="form-label">Prix promotionnel</label>
                                    <input type="number" class="form-control" id="prix_promo" name="prix_promo" value="{{ produit.prix_promo}}">
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="est_vendue" name="est_vendue" {% if produit.est_vendue %}checked{% endif %}>
                                        <label class="form-check-label" for="est_vendue">Marquer comme vendu</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Type de produit -->
                            <div class="mb-4">
                                <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-desktop me-2"></i>Type de produit</h5>
                                <div class="switch-field">
                                    {% if produit.est_pc %}
                                    <input type="radio" id="est_pc_oui" name="est_pc" value="True" checked/>
                                    <label for="est_pc_oui">Ordinateur</label>
                                    <input type="radio" id="est_pc_non" name="est_pc" value="False"/>
                                    <label for="est_pc_non">Accessoire</label>
                                    {% else %}
                                    <input type="radio" id="est_pc_oui" name="est_pc" value="True"/>
                                    <label for="est_pc_oui">Ordinateur</label>
                                    <input type="radio" id="est_pc_non" name="est_pc" value="False" checked/>
                                    <label for="est_pc_non">Accessoire</label>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Images du produit -->
                            <div class="mb-4">
                                <h5 class="border-bottom pb-2 mb-3"><i class="fas fa-images me-2"></i>Images du produit</h5>

                                <div class="image-preview">
                                    <p class="text-muted">Aperçu des images actuelles</p>
                                    <div class="d-flex flex-wrap justify-content-center" id="imagePreviewsContainer">
                                        <div class="image-upload-container">
                                            <img  {% if produit.image %} src="{{ produit.image.url }}" {% else %} src="" {% endif %} class="preview-img" id="preview1">
                                            <div class="btn-remove-image" onclick="removeImage(1)">
                                                <i class="fas fa-times"></i>
                                            </div>
                                        </div>
                                        <div class="image-upload-container">
                                            <img {% if produit.image2 %} src="{{ produit.image2.url }}" {% else %} src="" {% endif %} class="preview-img" id="preview2">
                                            <div class="btn-remove-image" onclick="removeImage(2)">
                                                <i class="fas fa-times"></i>
                                            </div>
                                        </div>
                                        <div class="image-upload-container">
                                            <img {% if produit.image3 %} src="{{ produit.image3.url }}" {% else %} src="" {% endif %} class="preview-img" id="preview3">
                                            <div class="btn-remove-image" onclick="removeImage(3)">
                                                <i class="fas fa-times"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="image1" class="form-label">Image principale <!--<span style="color:red" >*</span>--></label>
                                    <input type="file" class="form-control" id="image1" name="image" accept="image/*" >
                                </div>

                                <div class="mb-3">
                                    <label for="image2" class="form-label">Deuxième image <!--<span style="color:red" >*</span>--></label>
                                    <input type="file" class="form-control" id="image2" name="image2" accept="image/*" >
                                </div>

                                <div class="mb-3">
                                    <label for="image3" class="form-label">Troisième image <!--<span style="color:red" >*</span>--></label>
                                    <input type="file" class="form-control" id="image3" name="image3" accept="image/*" >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Boutons d'action -->
                    <div class="d-flex justify-content-between mt-4 flex-column flex-md-row">
                        <a href="{% url 'vendeur' %}" class="btn btn-outline-secondary mb-2 mb-md-0" id="btnCancel" style="color:#fff">
                            <i class="fas fa-arrow-left me-1 me-md-2" style="color:#fff"></i>Retour
                        </a>

                        <div class="action-buttons d-flex flex-column flex-md-row">
                            <button id="supp" type="submit" name="action" value="Supprimer" class="logout-btn btn btn-danger mb-2 mb-md-0 me-md-2" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                <i class="fas fa-trash me-1 me-md-2"></i>Supprimer
                            </button>

                            <button id="enrg" type="submit" name="action" value="Enregistrer" class="btn btn-primary" style="background:linear-gradient(135deg,var(--accent),var(--accent-2))">
                                <i class="fas fa-save me-1 me-md-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    <!--</div> -->

    <!-- Boîte de dialogue de confirmation -->
        <div id="logoutDialog" class="dialog-overlay">
            <div class="dialog-box">
                <div class="dialog-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h2 class="dialog-title">Confirmer la suppression</h2>
                <p class="dialog-message">Êtes-vous sûr de vouloir supprimer {{ vendeur.marque }} {{ vendeur.model }} ? </p>
                <div class="dialog-buttons">
                    <button class="dialog-btn btn-cancel" onclick="closeDialog()">
                        Non
                    </button>
                    <button class="dialog-btn btn-confirm" onclick="confirmSuppression()">
                        Oui
                    </button>
                </div>
            </div>
        </div>

{% include 'footer.html' %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/source.js' %}" ></script>
    <script>

        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }
        //---------------------------------------------------

        // Fonctions pour gérer la boîte de dialogue
    function openLogoutDialog() {
        const dialog = document.getElementById('logoutDialog');
        dialog.classList.add('active');
        document.body.style.overflow = 'hidden'; // Empêche le défilement
    }

    function closeDialog() {
        const dialog = document.getElementById('logoutDialog');
        dialog.classList.remove('active');
        document.body.style.overflow = ''; // Rétablit le défilement
    }

    function confirmSuppression() {
        // Fermer la boîte de dialogue
        closeDialog();

        document.getElementById('productForm').submit();
    }

    // Fermer la boîte de dialogue en cliquant à l'extérieur
    document.getElementById('logoutDialog').addEventListener('click', function(e) {
        if (e.target === this) {
            closeDialog();
        }
    });

    // Fermer avec la touche Échap
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeDialog();
        }
    });

    // Style pour le bouton de déconnexion (optionnel)
    const style = document.createElement('style');
    style.textContent = `
        .logout-btn {
            padding: 12px 24px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        .logout-btn:hover {
            background: #c82333;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
        }
    `;
    document.head.appendChild(style);

    //--------------------------------------------------------------


        // Mobile nav
    document.querySelector('.mobile-menu-btn').addEventListener('click',()=>document.getElementById('mobileNav').classList.add('open'));
    document.getElementById('closeMobileNav').addEventListener('click',()=>document.getElementById('mobileNav').classList.remove('open'));
    document.addEventListener('click', function(event){
      if(!document.getElementById('mobileNav').contains(event.target) && event.target !== document.querySelector('.mobile-menu-btn')){
        document.getElementById('mobileNav').classList.remove('open');
      }
    });

    // Masquer le panier
    panier = document.getElementById('cartBtn');
    panier.style.display = 'none';

         document.addEventListener('DOMContentLoaded', function() {
            const checkbox = document.getElementById('est_promo');
            const inputGroup = document.getElementById('prixPromoGroup');

            // Masquer au chargement si coché
            if (checkbox.checked) {
                inputGroup.classList.remove('hidden');
            } else {
                inputGroup.classList.add('hidden');
            }

            // Écouter les changements
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    inputGroup.classList.remove('hidden');
                } else {
                    inputGroup.classList.add('hidden');
                }
            });
        });

    /*document.getElementById('est_promo').addEventListener('change', function() {
        const inputGroup = document.getElementById('prixPromoGroup');

        if (this.checked) {
            inputGroup.classList.remove('hidden');
            inputGroup.classList.add('visible');
        } else {
            inputGroup.classList.remove('visible');
            inputGroup.classList.add('hidden');
        }
    }); */
    </script>
</body>
</html>