{% load static %}
{% include 'metadata_connexion.html' %}

<body>
  {% include 'header.html' %}

  <main>
    <div class="form-box">
      <h2>Récupération de code</h2>
      <form method="POST" id="recoverForm" >
          {% csrf_token %}
        <p style="color: red; font-size : 0.9rem; margin-bottom:25px;text-align:center">{{ msg2 }}</p>
        <p style="color: green; font-size : 0.9rem; margin-bottom:25px;text-align:center">{{ msg }}</p>
        <div class="form-group">
          <input type="email" id="recoverEmail" name="email" placeholder=" " value="{{ donnees.email }}" required>
          <label for="recoverEmail">Adresse e-mail</label>
        </div>
        <button type="submit" id="recoverBtn" class="btn">Envoyer</button>
        <div class="form-footer">
          Retour à la <a href="{% url 'login_vendeur' %}">connexion</a>
        </div>
      </form>
    </div>
  </main>

  {% include 'footer.html' %}
  <script src="{% static 'js/source.js' %}"></script>
<script>

    if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('recoverForm');

            form.addEventListener('submit', function() {
                // Changer l'URL sans recharger la page
                if (window.history.replaceState) {
                    window.history.replaceState(null, null, window.location.href);
                }
            });
        });

    document.getElementById('recoverForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        // Vérification de connexion sans CORS
        const isConnected = await checkInternetConnection();

        if (!isConnected) {
            showToast('❌ Connexion internet requise. Veuillez vérifier votre connexion.');
            return false;
        }

        document.getElementById('recoverForm').submit();

        document.getElementById('recoverForm').reset()

    });

        // Masquer le panier
    panier = document.getElementById('cartBtn');
    panier.style.display = 'none';

    // Mobile nav
    document.querySelector('.mobile-menu-btn').addEventListener('click',()=>document.getElementById('mobileNav').classList.add('open'));
    document.getElementById('closeMobileNav').addEventListener('click',()=>document.getElementById('mobileNav').classList.remove('open'));
    document.addEventListener('click', function(event){
      if(!document.getElementById('mobileNav').contains(event.target) && event.target !== document.querySelector('.mobile-menu-btn')){
        document.getElementById('mobileNav').classList.remove('open');
      }
    });
</script>
</body>
</html>
